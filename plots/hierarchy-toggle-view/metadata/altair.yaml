library: altair
specification_id: hierarchy-toggle-view
created: '2026-01-11T09:30:49Z'
updated: '2026-01-11T09:58:57Z'
generated_by: claude-opus-4-5-20251101
workflow_run: 20892893334
issue: 3697
python_version: 3.13.11
library_version: 6.0.0
preview_url: https://storage.googleapis.com/pyplots-images/plots/hierarchy-toggle-view/altair/plot.png
preview_thumb: https://storage.googleapis.com/pyplots-images/plots/hierarchy-toggle-view/altair/plot_thumb.png
preview_html: https://storage.googleapis.com/pyplots-images/plots/hierarchy-toggle-view/altair/plot.html
quality_score: 72
review:
  strengths:
  - Excellent implementation of dual-view toggle using Altair declarative selection
    system
  - Colorblind-friendly palette with good contrast between all four departments
  - Clean code structure implementing complex treemap layout algorithm without external
    dependencies
  - Proper use of Altair mark_arc for sunburst with correct angle calculations
  - Interactive tooltips showing team name, headcount, and department
  - Both PNG and HTML output correctly generated
  weaknesses:
  - 'Canvas utilization is poor: treemap only fills ~35-40% of the available space
    with large empty areas on left and bottom'
  - Legend is only visible in treemap view (legend=None on sunburst arcs), breaking
    consistency requirement
  - No animated transitions between views (spec mentions smooth animated transitions
    enhance user experience)
  image_description: 'The plot displays a treemap visualization (default view) of
    a company organizational structure. The canvas shows nested rectangles representing
    teams within four departments: Engineering (blue #306998), Sales (yellow #FFD43B),
    Marketing (red #E74C3C), and Operations (green #27AE60). Each rectangle is sized
    proportionally to headcount values, with white text labels centered in each cell.
    The title "hierarchy-toggle-view · altair · pyplots.ai" appears at the top with
    a subtitle explaining the dropdown toggle functionality. A legend on the right
    identifies the four department colors. The treemap occupies roughly 35-40% of
    the canvas area, positioned center-right with significant whitespace on the left
    side and bottom. Rectangle areas correctly reflect the data values (Backend and
    Frontend are largest in Engineering, Enterprise is largest in Sales, etc.). White
    stroke borders separate the rectangles cleanly.'
  criteria_checklist:
    visual_quality:
      score: 28
      max: 40
      items:
      - id: VQ-01
        name: Text Legibility
        score: 7
        max: 10
        passed: true
        comment: Labels are readable but some smaller cells have cramped text; title
          and legend text are appropriately sized
      - id: VQ-02
        name: No Overlap
        score: 8
        max: 8
        passed: true
        comment: No overlapping text elements
      - id: VQ-03
        name: Element Visibility
        score: 6
        max: 8
        passed: true
        comment: Rectangles are clearly visible with good stroke separation, but some
          smaller rectangles are quite compact
      - id: VQ-04
        name: Color Accessibility
        score: 5
        max: 5
        passed: true
        comment: Colorblind-friendly palette (blue, yellow, red, green with good differentiation)
      - id: VQ-05
        name: Layout Balance
        score: 2
        max: 5
        passed: false
        comment: Treemap only fills ~35-40% of canvas; significant whitespace on left
          and bottom; not optimally balanced
      - id: VQ-07
        name: Grid & Legend
        score: 2
        max: 2
        passed: true
        comment: Legend well-placed with clear labels; no distracting grid
    spec_compliance:
      score: 21
      max: 25
      items:
      - id: SC-01
        name: Plot Type
        score: 8
        max: 8
        passed: true
        comment: Correctly implements treemap AND sunburst toggle
      - id: SC-02
        name: Data Mapping
        score: 5
        max: 5
        passed: true
        comment: Hierarchy correctly represented with departments containing teams
      - id: SC-03
        name: Required Features
        score: 3
        max: 5
        passed: false
        comment: Toggle control implemented via dropdown; consistent colors across
          views; but no animated transitions between views
      - id: SC-04
        name: Data Range
        score: 3
        max: 3
        passed: true
        comment: All 18 nodes represented correctly
      - id: SC-05
        name: Legend Accuracy
        score: 0
        max: 2
        passed: false
        comment: Legend shows only in treemap view, not in sunburst view (legend=None
          for sunburst)
      - id: SC-06
        name: Title Format
        score: 2
        max: 2
        passed: true
        comment: Correct format {spec-id} · {library} · pyplots.ai
    data_quality:
      score: 18
      max: 20
      items:
      - id: DQ-01
        name: Feature Coverage
        score: 7
        max: 8
        passed: true
        comment: Shows 3-level hierarchy (Company→Departments→Teams), 18 nodes, proportional
          sizing; both views implemented
      - id: DQ-02
        name: Realistic Context
        score: 7
        max: 7
        passed: true
        comment: Company organizational structure with Engineering, Sales, Marketing,
          Operations is very realistic
      - id: DQ-03
        name: Appropriate Scale
        score: 4
        max: 5
        passed: true
        comment: Headcount values (20-62) are plausible for team sizes
    code_quality:
      score: 10
      max: 10
      items:
      - id: CQ-01
        name: KISS Structure
        score: 3
        max: 3
        passed: true
        comment: 'Linear script: imports → data → treemap layout → sunburst layout
          → charts → save'
      - id: CQ-02
        name: Reproducibility
        score: 3
        max: 3
        passed: true
        comment: np.random.seed(42) set
      - id: CQ-03
        name: Clean Imports
        score: 2
        max: 2
        passed: true
        comment: Only altair, numpy, pandas imported
      - id: CQ-04
        name: No Deprecated API
        score: 1
        max: 1
        passed: true
        comment: Uses current Altair 5.x/6.x API
      - id: CQ-05
        name: Output Correct
        score: 1
        max: 1
        passed: true
        comment: Saves as plot.png and plot.html
    library_features:
      score: 5
      max: 5
      items:
      - id: LF-01
        name: Distinctive Features
        score: 5
        max: 5
        passed: true
        comment: 'Excellent use of Altair features: selection_point with binding_select
          for interactive toggle, layered composition, mark_rect for treemap, mark_arc
          for sunburst, conditional opacity, tooltips'
  verdict: APPROVED
impl_tags:
  dependencies: []
  techniques:
  - layer-composition
  - hover-tooltips
  - html-export
  patterns:
  - data-generation
  - iteration-over-groups
  dataprep: []
  styling:
  - edge-highlighting
