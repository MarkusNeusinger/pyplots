library: bokeh
specification_id: map-marker-clustered
created: '2026-01-20T18:50:28Z'
updated: '2026-01-20T18:53:45Z'
generated_by: claude-opus-4-5-20251101
workflow_run: 21183368742
issue: 3766
python_version: 3.13.11
library_version: 3.8.2
preview_url: https://storage.googleapis.com/pyplots-images/plots/map-marker-clustered/bokeh/plot.png
preview_thumb: https://storage.googleapis.com/pyplots-images/plots/map-marker-clustered/bokeh/plot_thumb.png
preview_html: https://storage.googleapis.com/pyplots-images/plots/map-marker-clustered/bokeh/plot.html
quality_score: 88
review:
  strengths:
  - Excellent realistic coffee shop scenario with plausible NYC neighborhoods
  - Grid-based clustering algorithm effectively simulates zoom-level aggregation
  - Cluster markers clearly display counts with good contrast (white bold text on
    colored circles)
  - Good use of CartoDB Positron basemap for clean geographic context
  - Proper Web Mercator projection conversion
  - Interactive HTML export with pan/zoom/hover tools
  - Category coloring with dominant category determination per cluster
  - Legend with semi-transparent background is well-styled
  weaknesses:
  - Title includes extra "Store Locations" prefix - should be "{spec-id} · {library}
    · pyplots.ai"
  - Helper function lat_lon_to_mercator breaks pure KISS structure
  - p.add_tile() may trigger deprecation warning in newer Bokeh versions
  - Some cluster overlap in dense Manhattan area
  image_description: 'The plot displays a clustered marker map of store locations
    in the New York City area using a CartoDB Positron basemap. The map shows approximately
    25-30 cluster markers represented as circles of varying sizes. Most clusters are
    blue (Python Blue #306998) representing "Coffee" as the dominant category, with
    several yellow clusters (#FFD43B) for "Express" dominant locations. Each cluster
    marker displays a white number indicating the count of stores in that cluster
    (ranging from single digits like 3-6 up to larger counts like 35, 45). The clusters
    are concentrated in Manhattan, Brooklyn, and surrounding areas. Individual store
    positions are shown as faint blue dots (alpha=0.2) beneath the clusters. The legend
    on the right side shows "Store Type" with three categories visible: Coffee (dominant),
    Express (dominant), and Roastery (dominant). The title reads "Store Locations
    · map-marker-clustered · bokeh · pyplots.ai" in blue text. Axis labels show "Longitude"
    and "Latitude" with Mercator coordinates. An italic annotation at the bottom left
    states "Clustered markers show aggregated store counts".'
  criteria_checklist:
    visual_quality:
      score: 35
      max: 40
      items:
      - id: VQ-01
        name: Text Legibility
        score: 9
        max: 10
        passed: true
        comment: Title at 32pt is excellent, axis labels at 24pt are good, cluster
          count labels at 24pt are clearly readable. Legend text slightly small relative
          to canvas size.
      - id: VQ-02
        name: No Overlap
        score: 7
        max: 8
        passed: true
        comment: Most cluster markers are well-separated, some clusters in central
          Manhattan overlap slightly.
      - id: VQ-03
        name: Element Visibility
        score: 7
        max: 8
        passed: true
        comment: Cluster markers well-sized (45-110px), count labels are bold white
          text with good contrast. Individual markers intentionally faint.
      - id: VQ-04
        name: Color Accessibility
        score: 4
        max: 5
        passed: true
        comment: Blue and yellow provide good contrast. Green (Roastery) may be harder
          to distinguish for some users.
      - id: VQ-05
        name: Layout Balance
        score: 4
        max: 5
        passed: true
        comment: Good canvas utilization with map filling most of space. Legend on
          right creates some empty space.
      - id: VQ-06
        name: Axis Labels
        score: 1
        max: 2
        passed: false
        comment: Labels say Longitude/Latitude but show Mercator coordinates, no units
          specified.
      - id: VQ-07
        name: Grid & Legend
        score: 3
        max: 2
        passed: true
        comment: No visible grid (appropriate for maps), legend well-placed with good
          styling.
    spec_compliance:
      score: 23
      max: 25
      items:
      - id: SC-01
        name: Plot Type
        score: 8
        max: 8
        passed: true
        comment: Correct clustered marker map implementation
      - id: SC-02
        name: Data Mapping
        score: 5
        max: 5
        passed: true
        comment: Lat/lon correctly converted to Mercator and plotted
      - id: SC-03
        name: Required Features
        score: 4
        max: 5
        passed: true
        comment: Has clustering, count display, category coloring, basemap, hover
          tooltips. Missing click-to-zoom and smooth transitions (PNG limitation).
      - id: SC-04
        name: Data Range
        score: 3
        max: 3
        passed: true
        comment: Map view shows all clusters in NYC area appropriately
      - id: SC-05
        name: Legend Accuracy
        score: 2
        max: 2
        passed: true
        comment: Legend correctly shows store types with (dominant) suffix
      - id: SC-06
        name: Title Format
        score: 1
        max: 2
        passed: false
        comment: Includes extra 'Store Locations' prefix - should be just '{spec-id}
          · {library} · pyplots.ai'
    data_quality:
      score: 19
      max: 20
      items:
      - id: DQ-01
        name: Feature Coverage
        score: 7
        max: 8
        passed: true
        comment: Shows clustering at different densities, multiple categories, count
          labels. Good variety of cluster sizes.
      - id: DQ-02
        name: Realistic Context
        score: 7
        max: 7
        passed: true
        comment: Coffee shop chain locations in NYC is an excellent, realistic scenario
      - id: DQ-03
        name: Appropriate Scale
        score: 5
        max: 5
        passed: true
        comment: 270 total points across 10 neighborhoods, realistic geographic distribution
    code_quality:
      score: 8
      max: 10
      items:
      - id: CQ-01
        name: KISS Structure
        score: 2
        max: 3
        passed: false
        comment: Defines helper function lat_lon_to_mercator which breaks pure KISS
          structure
      - id: CQ-02
        name: Reproducibility
        score: 3
        max: 3
        passed: true
        comment: Uses np.random.seed(42)
      - id: CQ-03
        name: Clean Imports
        score: 2
        max: 2
        passed: true
        comment: All imports are used
      - id: CQ-04
        name: No Deprecated API
        score: 0
        max: 1
        passed: false
        comment: p.add_tile() is deprecated in Bokeh 3.x
      - id: CQ-05
        name: Output Correct
        score: 1
        max: 1
        passed: true
        comment: Saves as plot.png and plot.html
    library_features:
      score: 3
      max: 5
      items:
      - id: LF-01
        name: Distinctive Features
        score: 3
        max: 5
        passed: true
        comment: Uses ColumnDataSource, WMTSTileSource, LabelSet, hover tooltips,
          HTML export. Missing callbacks for interactive clustering.
  verdict: REJECTED
impl_tags:
  dependencies:
  - selenium
  techniques:
  - hover-tooltips
  - annotations
  - html-export
  - custom-legend
  patterns:
  - data-generation
  - columndatasource
  - iteration-over-groups
  dataprep: []
  styling:
  - alpha-blending
