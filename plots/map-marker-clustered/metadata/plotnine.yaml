library: plotnine
specification_id: map-marker-clustered
created: '2026-01-20T18:52:40Z'
updated: '2026-01-20T19:54:22Z'
generated_by: claude-opus-4-5-20251101
workflow_run: 21183361240
issue: 3766
python_version: 3.13.11
library_version: 0.15.2
preview_url: https://storage.googleapis.com/pyplots-images/plots/map-marker-clustered/plotnine/plot.png
preview_thumb: https://storage.googleapis.com/pyplots-images/plots/map-marker-clustered/plotnine/plot_thumb.png
preview_html: null
quality_score: 78
review:
  strengths:
  - Colorblind-friendly palette with good visual distinction between categories
  - Proper title format following spec-id · library · pyplots.ai convention
  - Realistic geographic data scenario (US West Coast retail locations)
  - Good use of hierarchical clustering via scipy to create meaningful groupings
  - Clean code structure with clear variable naming
  weaknesses:
  - Significant marker overlap in dense regions makes cluster counts hard to read
  - Missing geographic basemap/context as specified (just plain coordinate grid)
  - Redundant legends (Category showing only Retail, plus Cluster Category showing
    all four)
  - Axis labels lack units (should be °W, °N)
  image_description: 'The plot displays a clustered marker map of US West Coast store
    locations on a 16:9 canvas. Three main geographic regions are visible: Seattle/Portland
    area (lat ~45-48), San Francisco area (lat ~38), and Los Angeles/San Diego area
    (lat ~32-35). Markers are circular with sizes varying based on cluster count and
    colored by dominant category: blue (#4477AA for Retail), yellow/gold (#CCBB44
    for Entertainment), coral/pink (#EE6677 for Restaurant), and green (#228833 for
    Service). White numbers appear inside markers showing point counts. The title
    reads "map-marker-clustered · plotnine · pyplots.ai" in bold at the top. Axes
    are labeled "Longitude" and "Latitude". Three separate legends appear on the right:
    "Category" (showing only Retail), "Cluster Category" (showing all four categories),
    and "Points in Cluster" (showing size scale with values 5, 10, 15, 20). The background
    is light gray with subtle grid lines.'
  criteria_checklist:
    visual_quality:
      score: 30
      max: 40
      items:
      - id: VQ-01
        name: Text Legibility
        score: 8
        max: 10
        passed: true
        comment: Title and axis labels readable, but cluster count labels overlap
          heavily in dense regions
      - id: VQ-02
        name: No Overlap
        score: 4
        max: 8
        passed: false
        comment: Significant marker overlap in Seattle/Portland and LA/San Diego regions;
          cluster labels difficult to read
      - id: VQ-03
        name: Element Visibility
        score: 6
        max: 8
        passed: true
        comment: Markers visible but overlapping reduces clarity; size scaling works
      - id: VQ-04
        name: Color Accessibility
        score: 5
        max: 5
        passed: true
        comment: Colorblind-friendly palette used (blue, yellow, coral, green)
      - id: VQ-05
        name: Layout Balance
        score: 4
        max: 5
        passed: true
        comment: Good use of canvas, legends properly placed, minor whitespace on
          left
      - id: VQ-06
        name: Axis Labels
        score: 1
        max: 2
        passed: false
        comment: Labels say Longitude and Latitude without units
      - id: VQ-07
        name: Grid & Legend
        score: 2
        max: 2
        passed: true
        comment: Subtle grid, legends well-organized
    spec_compliance:
      score: 20
      max: 25
      items:
      - id: SC-01
        name: Plot Type
        score: 6
        max: 8
        passed: true
        comment: Shows clustered markers but missing basemap/geographic context as
          specified
      - id: SC-02
        name: Data Mapping
        score: 5
        max: 5
        passed: true
        comment: Lat/lon correctly mapped to axes
      - id: SC-03
        name: Required Features
        score: 3
        max: 5
        passed: false
        comment: 'Missing: basemap with geographic context, interactive clustering
          not feasible in plotnine'
      - id: SC-04
        name: Data Range
        score: 3
        max: 3
        passed: true
        comment: Full US West Coast range shown correctly
      - id: SC-05
        name: Legend Accuracy
        score: 1
        max: 2
        passed: false
        comment: Multiple redundant legends, confusing
      - id: SC-06
        name: Title Format
        score: 2
        max: 2
        passed: true
        comment: 'Correct format: map-marker-clustered · plotnine · pyplots.ai'
    data_quality:
      score: 16
      max: 20
      items:
      - id: DQ-01
        name: Feature Coverage
        score: 6
        max: 8
        passed: true
        comment: Shows clustering by location, category coloring, size by count; but
          overlap obscures detail
      - id: DQ-02
        name: Realistic Context
        score: 7
        max: 7
        passed: true
        comment: Realistic store location scenario with plausible US West Coast coordinates
      - id: DQ-03
        name: Appropriate Scale
        score: 3
        max: 5
        passed: true
        comment: Coordinates realistic; cluster counts seem off based on legend values
    code_quality:
      score: 9
      max: 10
      items:
      - id: CQ-01
        name: KISS Structure
        score: 3
        max: 3
        passed: true
        comment: 'Linear flow: imports → data → clustering → plot → save'
      - id: CQ-02
        name: Reproducibility
        score: 3
        max: 3
        passed: true
        comment: np.random.seed(42) set
      - id: CQ-03
        name: Clean Imports
        score: 2
        max: 2
        passed: true
        comment: All imports used
      - id: CQ-04
        name: No Deprecated API
        score: 1
        max: 1
        passed: true
        comment: Modern plotnine API
      - id: CQ-05
        name: Output Correct
        score: 0
        max: 1
        passed: false
        comment: 'Minor: saves correctly but width/height redundant with figure_size'
    library_features:
      score: 3
      max: 5
      items:
      - id: LF-01
        name: Distinctive Features
        score: 3
        max: 5
        passed: true
        comment: Uses plotnine grammar of graphics (ggplot + geom_point + geom_text
          + scale_*), but no distinctive advanced features
  verdict: APPROVED
impl_tags:
  dependencies:
  - scipy
  techniques:
  - annotations
  - layer-composition
  - custom-legend
  patterns:
  - data-generation
  - groupby-aggregation
  - iteration-over-groups
  dataprep:
  - hierarchical-clustering
  styling:
  - alpha-blending
  - grid-styling
