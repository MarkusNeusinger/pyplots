library: altair
specification_id: hierarchy-toggle-view
created: '2026-01-11T09:30:49Z'
updated: '2026-01-11T09:52:51Z'
generated_by: claude-opus-4-5-20251101
workflow_run: 20892893334
issue: 3697
python_version: 3.13.11
library_version: 6.0.0
preview_url: https://storage.googleapis.com/pyplots-images/plots/hierarchy-toggle-view/altair/plot.png
preview_thumb: https://storage.googleapis.com/pyplots-images/plots/hierarchy-toggle-view/altair/plot_thumb.png
preview_html: https://storage.googleapis.com/pyplots-images/plots/hierarchy-toggle-view/altair/plot.html
quality_score: 72
review:
  strengths:
  - Excellent use of Altair selection binding for interactive toggle between views
  - Well-implemented squarified treemap algorithm for good aspect ratios
  - Clear color scheme with four distinct, colorblind-friendly department colors
  - Good data context with realistic organizational structure
  - Proper implementation of both treemap and sunburst views with shared data/colors
  weaknesses:
  - Treemap only fills ~50% of canvas vertically, leaving large empty space below
    the visualization
  - Some labels truncated due to small cell sizes (e.g., Facilitie, Partnershi)
  - Code contains helper function (squarify_layout) violating KISS structure principle
  - Static PNG only shows treemap view; sunburst only visible in interactive HTML
  image_description: |-
    The plot displays a treemap visualization showing a company organizational structure with nested rectangles. The treemap fills approximately 50% of the vertical canvas (upper half), with significant whitespace below. There are four departments color-coded: Engineering (blue #306998), Sales (yellow #FFD43B), Marketing (red #E74C3C), and Operations (green #27AE60).

    The largest rectangle is "Backend" (blue, Engineering) at the bottom. Other Engineering teams include Frontend, Data Science, DevOps, and QA. Sales teams (Enterprise, SMB, Partnerships) are shown in yellow. Marketing teams (Content, Events, Digital, Brand) in red, with some labels truncated (e.g., "Facilitie", "Brand"). Operations teams (HR, Finance, Legal) in green.

    The title reads "hierarchy-toggle-view 路 altair 路 pyplots.ai" with subtitle "Use dropdown to toggle between Treemap and Sunburst views". A legend on the right shows the four department colors. White stroke borders separate the rectangles. Labels are white text centered in each cell with size scaled by value.

    Critical issue: The treemap only fills the top ~50% of the canvas vertically, leaving the bottom half completely empty. This is a significant layout problem - the visualization should fill more of the available canvas area.

    Label issues: Some labels appear truncated or clipped (e.g., "Facilitie" instead of "Facilities", "Partnershi" instead of "Partnerships").
  criteria_checklist:
    visual_quality:
      score: 29
      max: 40
      items:
      - id: VQ-01
        name: Text Legibility
        score: 8
        max: 10
        passed: true
        comment: Title 28pt is good, labels readable but some are truncated due to
          cell size
      - id: VQ-02
        name: No Overlap
        score: 6
        max: 8
        passed: true
        comment: Minor truncation of labels like Facilitie, Partnershi due to small
          cells
      - id: VQ-03
        name: Element Visibility
        score: 6
        max: 8
        passed: true
        comment: Rectangles well-sized, but small cells make some labels hard to fit
      - id: VQ-04
        name: Color Accessibility
        score: 5
        max: 5
        passed: true
        comment: 'Four distinct colorblind-friendly colors: blue, yellow, red, green'
      - id: VQ-05
        name: Layout Balance
        score: 2
        max: 5
        passed: false
        comment: Treemap only fills ~50% of canvas vertically; significant empty space
          below
      - id: VQ-06
        name: Axis Labels
        score: 0
        max: 2
        passed: false
        comment: Not applicable for treemap visualization
      - id: VQ-07
        name: Grid & Legend
        score: 2
        max: 2
        passed: true
        comment: Legend well placed on right, no grid needed for treemap
    spec_compliance:
      score: 20
      max: 25
      items:
      - id: SC-01
        name: Plot Type
        score: 8
        max: 8
        passed: true
        comment: Correct treemap visualization with toggle to sunburst (interactive)
      - id: SC-02
        name: Data Mapping
        score: 5
        max: 5
        passed: true
        comment: Area correctly proportional to headcount values
      - id: SC-03
        name: Required Features
        score: 3
        max: 5
        passed: false
        comment: Toggle exists but sunburst view is hidden in static PNG
      - id: SC-04
        name: Data Range
        score: 3
        max: 3
        passed: true
        comment: All data visible
      - id: SC-05
        name: Legend Accuracy
        score: 2
        max: 2
        passed: true
        comment: Legend correctly identifies departments
      - id: SC-06
        name: Title Format
        score: 2
        max: 2
        passed: true
        comment: 'Correct format: hierarchy-toggle-view 路 altair 路 pyplots.ai'
    data_quality:
      score: 18
      max: 20
      items:
      - id: DQ-01
        name: Feature Coverage
        score: 6
        max: 8
        passed: true
        comment: Shows 3-level hierarchy but departments only visible via color, not
          explicit nesting
      - id: DQ-02
        name: Realistic Context
        score: 7
        max: 7
        passed: true
        comment: TechCorp Inc. organization structure is realistic business scenario
      - id: DQ-03
        name: Appropriate Scale
        score: 5
        max: 5
        passed: true
        comment: Headcount values 20-62 are realistic team sizes
    code_quality:
      score: 7
      max: 10
      items:
      - id: CQ-01
        name: KISS Structure
        score: 1
        max: 3
        passed: false
        comment: Contains functions (squarify_layout) which violates KISS principle
      - id: CQ-02
        name: Reproducibility
        score: 3
        max: 3
        passed: true
        comment: np.random.seed(42) set
      - id: CQ-03
        name: Clean Imports
        score: 2
        max: 2
        passed: true
        comment: Only altair, numpy, pandas imported
      - id: CQ-04
        name: No Deprecated API
        score: 1
        max: 1
        passed: true
        comment: Current API usage
      - id: CQ-05
        name: Output Correct
        score: 0
        max: 1
        passed: false
        comment: Saves as plot.png but note label truncation issue
    library_features:
      score: 5
      max: 5
      items:
      - id: LF-01
        name: Distinctive Features
        score: 5
        max: 5
        passed: true
        comment: Excellent use of Altair selection binding for toggle, layered composition,
          conditional opacity
  verdict: APPROVED
impl_tags:
  dependencies: []
  techniques:
  - layer-composition
  - hover-tooltips
  - html-export
  patterns:
  - data-generation
  - iteration-over-groups
  dataprep: []
  styling:
  - edge-highlighting
