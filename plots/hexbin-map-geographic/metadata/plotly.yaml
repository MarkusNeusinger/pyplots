library: plotly
specification_id: hexbin-map-geographic
created: '2026-01-20T21:16:12Z'
updated: '2026-01-20T21:28:56Z'
generated_by: claude-opus-4-5-20251101
workflow_run: 21187394771
issue: 3767
python_version: 3.13.11
library_version: 6.5.2
preview_url: https://storage.googleapis.com/pyplots-images/plots/hexbin-map-geographic/plotly/plot.png
preview_thumb: https://storage.googleapis.com/pyplots-images/plots/hexbin-map-geographic/plotly/plot_thumb.png
preview_html: https://storage.googleapis.com/pyplots-images/plots/hexbin-map-geographic/plotly/plot.html
quality_score: 78
review:
  strengths:
  - Excellent use of H3 library for proper hexagonal binning with geographic precision
  - Good integration of Plotly choropleth_map with custom GeoJSON
  - Realistic NYC taxi scenario that demonstrates real-world hexbin mapping use case
  - Interactive HTML export supports hover tooltips as required by spec
  - Clean visual presentation with appropriate colormap and transparency
  weaknesses:
  - 'Colorbar label discrepancy: code sets colorbar.title=Pickup Count but image shows
    Avg Fare ($) - need to ensure code and output match'
  - Hexagon boundaries are not clearly visible in dense areas - spec requests clearly
    shows data aggregation boundaries - consider increasing marker_line_width or using
    contrasting line color
  - Code structure uses multiple loops which is more complex than typical KISS pattern
  - Does not demonstrate all three aggregation methods (count, sum, mean) - only count
    is shown
  image_description: The plot displays a geographic map of the NYC metropolitan area
    (including parts of New Jersey, Manhattan, Brooklyn, and surrounding boroughs)
    with hexagonal bins overlaid representing taxi pickup density. The base map uses
    Carto Positron styling with subtle gray streets and labeled place names (Newark,
    Jersey City, New York, Elizabeth, Bayonne, etc.). Hexagons are colored using a
    yellow-to-red sequential colormap, with pale yellow/cream representing lower values
    and deep red/orange representing higher values. The hexagons are most densely
    concentrated in Manhattan and Jersey City areas, showing clear hotspots. The title
    "NYC Taxi Pickups · hexbin-map-geographic · plotly · pyplots.ai" appears centered
    at the top. A vertical colorbar on the right side shows the scale labeled "Avg
    Fare ($)" ranging from approximately 20 to 100+. The overall layout has good proportions
    with the map taking most of the canvas area.
  criteria_checklist:
    visual_quality:
      score: 32
      max: 40
      items:
      - id: VQ-01
        name: Text Legibility
        score: 8
        max: 10
        passed: true
        comment: Title readable but slightly small for canvas size. Map labels and
          colorbar text readable.
      - id: VQ-02
        name: No Overlap
        score: 8
        max: 8
        passed: true
        comment: No overlapping text elements
      - id: VQ-03
        name: Element Visibility
        score: 6
        max: 8
        passed: true
        comment: Hexagons visible but boundaries between adjacent hexagons not clearly
          distinguishable in dense areas
      - id: VQ-04
        name: Color Accessibility
        score: 5
        max: 5
        passed: true
        comment: YlOrRd colormap is colorblind-safe
      - id: VQ-05
        name: Layout Balance
        score: 3
        max: 5
        passed: true
        comment: Good overall but some empty space on left side due to map framing
      - id: VQ-06
        name: Axis Labels
        score: 0
        max: 2
        passed: false
        comment: Colorbar label says Avg Fare ($) but code maps color=count - mismatch
          between code and rendered output
      - id: VQ-07
        name: Grid & Legend
        score: 2
        max: 2
        passed: true
        comment: Colorbar well positioned and clear
    spec_compliance:
      score: 18
      max: 25
      items:
      - id: SC-01
        name: Plot Type
        score: 8
        max: 8
        passed: true
        comment: Correct hexbin map geographic visualization
      - id: SC-02
        name: Data Mapping
        score: 5
        max: 5
        passed: true
        comment: Lat/lon correctly mapped to hexagonal cells via H3
      - id: SC-03
        name: Required Features
        score: 2
        max: 5
        passed: false
        comment: Does not demonstrate all aggregation methods (count, sum, mean) mentioned
          in spec
      - id: SC-04
        name: Data Range
        score: 3
        max: 3
        passed: true
        comment: All data points visible within map bounds
      - id: SC-05
        name: Legend Accuracy
        score: 0
        max: 2
        passed: false
        comment: 'Critical: Colorbar label says Avg Fare ($) but code maps color=count
          with title Pickup Count'
      - id: SC-06
        name: Title Format
        score: 2
        max: 2
        passed: true
        comment: 'Correct format: NYC Taxi Pickups · hexbin-map-geographic · plotly
          · pyplots.ai'
    data_quality:
      score: 18
      max: 20
      items:
      - id: DQ-01
        name: Feature Coverage
        score: 7
        max: 8
        passed: true
        comment: Shows clustering, density variation, geographic context; missing
          demonstration of multiple aggregation methods
      - id: DQ-02
        name: Realistic Context
        score: 7
        max: 7
        passed: true
        comment: NYC taxi pickups is a perfect real-world scenario for hexbin mapping
      - id: DQ-03
        name: Appropriate Scale
        score: 4
        max: 5
        passed: true
        comment: 5000 points is appropriate; fare values realistic ($5-$100+ range)
    code_quality:
      score: 6
      max: 10
      items:
      - id: CQ-01
        name: KISS Structure
        score: 1
        max: 3
        passed: false
        comment: Uses loops for cluster generation and GeoJSON creation - more complex
          than typical KISS pattern
      - id: CQ-02
        name: Reproducibility
        score: 3
        max: 3
        passed: true
        comment: np.random.seed(42) correctly set
      - id: CQ-03
        name: Clean Imports
        score: 2
        max: 2
        passed: true
        comment: All imports used (h3, numpy, pandas, plotly.express)
      - id: CQ-04
        name: No Deprecated API
        score: 0
        max: 1
        passed: false
        comment: hover_data format could be cleaner
      - id: CQ-05
        name: Output Correct
        score: 1
        max: 1
        passed: true
        comment: Saves as plot.png and plot.html
    library_features:
      score: 4
      max: 5
      items:
      - id: LF-01
        name: Distinctive Features
        score: 4
        max: 5
        passed: true
        comment: Good use of Plotly interactive features (hover, zoom, pan), map styles,
          GeoJSON integration; HTML export for interactivity
  verdict: REJECTED
impl_tags:
  dependencies:
  - h3
  techniques:
  - colorbar
  - hover-tooltips
  - html-export
  patterns:
  - data-generation
  - groupby-aggregation
  - iteration-over-groups
  dataprep:
  - binning
  styling:
  - custom-colormap
  - alpha-blending
  - edge-highlighting
