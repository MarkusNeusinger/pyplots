library: plotnine
specification_id: hierarchy-toggle-view
created: '2026-01-11T10:08:26Z'
updated: '2026-01-11T10:12:05Z'
generated_by: claude-opus-4-5-20251101
workflow_run: 20893328834
issue: 3697
python_version: 3.13.11
library_version: 0.15.2
preview_url: https://storage.googleapis.com/pyplots-images/plots/hierarchy-toggle-view/plotnine/plot.png
preview_thumb: https://storage.googleapis.com/pyplots-images/plots/hierarchy-toggle-view/plotnine/plot_thumb.png
preview_html: null
quality_score: 85
review:
  strengths:
  - Excellent side-by-side comparison of both visualization types with consistent
    colors
  - Good use of plotnine grammar of graphics approach with layer composition
  - Clean hierarchical data representation with 18 nodes across 3 levels
  - Proper sunburst implementation using geom_polygon for annular segments
  - Well-implemented squarify algorithm for treemap layout
  - Center label in sunburst showing total is a nice touch
  weaknesses:
  - Missing interactive toggle control - spec requires toggle button but plotnine
    is static (library limitation)
  - Significant whitespace at bottom of canvas could be better utilized
  - Some text labels in smaller segments are quite small
  - The sys.path manipulation at start is unusual code pattern
  image_description: |-
    The plot displays a side-by-side comparison of two hierarchical visualization types: a treemap on the left and a sunburst chart on the right, separated by a vertical dashed line. Both views show corporate budget allocation data across four departments: Engineering (blue), Sales (yellow), Marketing (green), and Operations (red).

    Treemap View (left): Nested rectangles with area proportional to values. Each department shows child teams with percentage labels (Backend 16%, Frontend 13%, DevOps 9%, North 12%, South 10%, East 8%, Digital 11%, Brand 7%, Logistics, Facilities). Department labels appear at the bottom of each section. Departments have transparent backgrounds with child rectangles in slightly varied shades.

    Sunburst View (right): Concentric rings showing hierarchy - inner ring contains departments, outer ring shows teams. Center displays "Total $1140K". Labels for larger segments are visible, with department names in white on the inner ring and team names on the outer ring.

    A legend between the views shows the four department colors. Title "hierarchy-toggle-view · plotnine · pyplots.ai" appears at the top.
  criteria_checklist:
    visual_quality:
      score: 32
      max: 40
      items:
      - id: VQ-01
        name: Text Legibility
        score: 8
        max: 10
        passed: true
        comment: Most text readable; some smaller labels (7%, 8%) are quite small
          but still legible
      - id: VQ-02
        name: No Overlap
        score: 8
        max: 8
        passed: true
        comment: No overlapping text elements
      - id: VQ-03
        name: Element Visibility
        score: 6
        max: 8
        passed: true
        comment: Elements visible but some small segments (Facilities, Logistics)
          are narrow in sunburst
      - id: VQ-04
        name: Color Accessibility
        score: 5
        max: 5
        passed: true
        comment: Good colorblind-safe palette; blue, yellow, green, red distinct
      - id: VQ-05
        name: Layout Balance
        score: 3
        max: 5
        passed: true
        comment: Treemap and sunburst well positioned but significant whitespace at
          bottom
      - id: VQ-06
        name: Axis Labels
        score: 0
        max: 2
        passed: true
        comment: N/A for this plot type (no axes)
      - id: VQ-07
        name: Grid & Legend
        score: 2
        max: 2
        passed: true
        comment: Legend well placed, no grid (appropriate)
    spec_compliance:
      score: 22
      max: 25
      items:
      - id: SC-01
        name: Plot Type
        score: 6
        max: 8
        passed: true
        comment: Shows both treemap and sunburst views, but NO toggle/switch control
          as spec requires - static side-by-side comparison
      - id: SC-02
        name: Data Mapping
        score: 5
        max: 5
        passed: true
        comment: Hierarchy correctly mapped; values determine area/angle
      - id: SC-03
        name: Required Features
        score: 4
        max: 5
        passed: true
        comment: Missing interactive toggle button; colors consistent across views
      - id: SC-04
        name: Data Range
        score: 3
        max: 3
        passed: true
        comment: All data visible in both views
      - id: SC-05
        name: Legend Accuracy
        score: 2
        max: 2
        passed: true
        comment: Legend correctly shows departments
      - id: SC-06
        name: Title Format
        score: 2
        max: 2
        passed: true
        comment: 'Correct format: hierarchy-toggle-view · plotnine · pyplots.ai'
    data_quality:
      score: 18
      max: 20
      items:
      - id: DQ-01
        name: Feature Coverage
        score: 7
        max: 8
        passed: true
        comment: Shows 3-level hierarchy (company → department → team), 18 nodes,
          good variation in sizes
      - id: DQ-02
        name: Realistic Context
        score: 7
        max: 7
        passed: true
        comment: Corporate budget allocation is a realistic, neutral business scenario
      - id: DQ-03
        name: Appropriate Scale
        score: 4
        max: 5
        passed: true
        comment: Values in thousands ($140K-$180K for teams) are realistic; total
          $1140K reasonable
    code_quality:
      score: 8
      max: 10
      items:
      - id: CQ-01
        name: KISS Structure
        score: 2
        max: 3
        passed: true
        comment: Uses helper functions (squarify_layout, create_annular_segment) which
          adds complexity but necessary for this plot type
      - id: CQ-02
        name: Reproducibility
        score: 3
        max: 3
        passed: true
        comment: Deterministic data (no random seed needed as data is explicit)
      - id: CQ-03
        name: Clean Imports
        score: 2
        max: 2
        passed: true
        comment: All imports used
      - id: CQ-04
        name: No Deprecated API
        score: 1
        max: 1
        passed: true
        comment: Uses current plotnine API
      - id: CQ-05
        name: Output Correct
        score: 0
        max: 1
        passed: false
        comment: sys.path manipulation at start is unusual code pattern
    library_features:
      score: 5
      max: 5
      items:
      - id: LF-01
        name: Distinctive Features
        score: 5
        max: 5
        passed: true
        comment: 'Excellent use of plotnine grammar of graphics: geom_rect, geom_polygon,
          geom_text, scale_fill_identity, coord_fixed, annotate. Shows layer composition
          approach typical of ggplot2 philosophy.'
  verdict: APPROVED
impl_tags:
  dependencies: []
  techniques:
  - annotations
  - layer-composition
  - patches
  patterns:
  - data-generation
  - iteration-over-groups
  dataprep: []
  styling:
  - alpha-blending
  - edge-highlighting
  - minimal-chrome
