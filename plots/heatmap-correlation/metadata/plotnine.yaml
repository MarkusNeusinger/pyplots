library: plotnine
specification_id: heatmap-correlation
created: '2025-12-26T10:03:58Z'
updated: '2025-12-26T10:07:50Z'
generated_by: claude-opus-4-5-20251101
workflow_run: 20520464769
issue: 1948
python_version: 3.13.11
library_version: 0.15.2
preview_url: https://storage.googleapis.com/pyplots-images/plots/heatmap-correlation/plotnine/plot.png
preview_thumb: https://storage.googleapis.com/pyplots-images/plots/heatmap-correlation/plotnine/plot_thumb.png
preview_html: null
quality_score: 92
review:
  strengths:
  - Excellent diverging color scheme (blue-white-red) perfectly suited for correlation
    visualization
  - Lower triangle masking reduces visual redundancy as recommended in spec
  - Clear cell annotations with proper formatting (2 decimal places)
  - Realistic financial portfolio data demonstrating varied correlation patterns
  - Proper use of coord_fixed(ratio=1) for square cells
  - Clean code structure following KISS principles
  - Title follows exact pyplots.ai format
  weaknesses:
  - Legend could be positioned slightly closer to the heatmap to reduce whitespace
  - Data does not include any extreme negative correlations (below -0.35) to show
    the full range of the diverging colormap blue end
  image_description: 'The plot displays a lower-triangular correlation matrix heatmap
    for 8 portfolio assets (Stock_A, Stock_B, Stock_C, Bonds, Gold, Real_Estate, Oil,
    Tech_Index). The heatmap uses a diverging color scheme: deep blue (#2166AC) for
    negative correlations, white for zero correlation, and deep red (#B2182B) for
    positive correlations. Each cell is annotated with the correlation coefficient
    to 2 decimal places in black text. The colorbar on the right shows "Correlation
    Coefficient" ranging from -1.0 to 1.0. The title "heatmap-correlation · plotnine
    · pyplots.ai" is bold and centered at the top. X-axis labels are rotated 45 degrees
    for readability. The plot uses a square 1:1 aspect ratio with coord_fixed, and
    grid lines are removed for cleaner visualization.'
  criteria_checklist:
    visual_quality:
      score: 37
      max: 40
      items:
      - id: VQ-01
        name: Text Legibility
        score: 10
        max: 10
        passed: true
        comment: Title is bold 26pt, axis titles 22pt, tick labels 16pt, cell annotations
          14pt - all clearly readable
      - id: VQ-02
        name: No Overlap
        score: 8
        max: 8
        passed: true
        comment: No overlapping text; x-axis labels rotated 45° to prevent collision
      - id: VQ-03
        name: Element Visibility
        score: 8
        max: 8
        passed: true
        comment: Tiles are well-sized, annotations clearly visible, good contrast
      - id: VQ-04
        name: Color Accessibility
        score: 5
        max: 5
        passed: true
        comment: Blue-white-red diverging scheme is colorblind-safe (RdBu variant)
      - id: VQ-05
        name: Layout Balance
        score: 4
        max: 5
        passed: true
        comment: Good use of 12×12 square canvas; slight whitespace on right due to
          legend
      - id: VQ-06
        name: Axis Labels
        score: 1
        max: 2
        passed: true
        comment: Descriptive "Portfolio Asset" labels but no units (correlation matrices
          don't have units, so acceptable)
      - id: VQ-07
        name: Grid & Legend
        score: 1
        max: 2
        passed: true
        comment: Grid removed (appropriate for heatmap); legend well-placed but could
          be slightly closer
    spec_compliance:
      score: 25
      max: 25
      items:
      - id: SC-01
        name: Plot Type
        score: 8
        max: 8
        passed: true
        comment: Correct heatmap for correlation matrix
      - id: SC-02
        name: Data Mapping
        score: 5
        max: 5
        passed: true
        comment: Variables correctly mapped to both axes
      - id: SC-03
        name: Required Features
        score: 5
        max: 5
        passed: true
        comment: Diverging colormap ✓, centered at zero ✓, annotations with 2 decimals
          ✓, lower triangle to reduce redundancy ✓, colorbar range -1 to 1
      - id: SC-04
        name: Data Range
        score: 3
        max: 3
        passed: true
        comment: All correlations displayed correctly (-1 to 1)
      - id: SC-05
        name: Legend Accuracy
        score: 2
        max: 2
        passed: true
        comment: Colorbar correctly labeled "Correlation Coefficient"
      - id: SC-06
        name: Title Format
        score: 2
        max: 2
        passed: true
        comment: 'Correct format: "heatmap-correlation · plotnine · pyplots.ai"'
    data_quality:
      score: 18
      max: 20
      items:
      - id: DQ-01
        name: Feature Coverage
        score: 7
        max: 8
        passed: true
        comment: 'Shows positive correlations (stocks), negative correlations (bonds
          vs stocks), near-zero correlations (gold), and diagonal (1.00). Minor: could
          include one extreme negative (-0.8+) for fuller range'
      - id: DQ-02
        name: Realistic Context
        score: 7
        max: 7
        passed: true
        comment: Financial portfolio correlation is a perfect real-world scenario
          for this plot type
      - id: DQ-03
        name: Appropriate Scale
        score: 4
        max: 5
        passed: true
        comment: Values are realistic for financial assets; correlations range from
          -0.35 to 0.91 which is plausible
    code_quality:
      score: 9
      max: 10
      items:
      - id: CQ-01
        name: KISS Structure
        score: 3
        max: 3
        passed: true
        comment: Clean imports → data → plot → save structure
      - id: CQ-02
        name: Reproducibility
        score: 3
        max: 3
        passed: true
        comment: np.random.seed(42) set (though not strictly needed since data is
          hardcoded)
      - id: CQ-03
        name: Clean Imports
        score: 2
        max: 2
        passed: true
        comment: All imports are used
      - id: CQ-04
        name: No Deprecated API
        score: 1
        max: 1
        passed: true
        comment: Modern plotnine API
      - id: CQ-05
        name: Output Correct
        score: 0
        max: 1
        passed: false
        comment: Saves as plot.png ✓ but uses separate width/height in save() instead
          of relying solely on figure_size
    library_features:
      score: 3
      max: 5
      items:
      - id: LF-01
        name: Distinctive Features
        score: 3
        max: 5
        passed: true
        comment: 'Uses plotnine grammar of graphics well: geom_tile + geom_text +
          scale_fill_gradient2 + coord_fixed + theme customization. Could leverage
          more plotnine-specific features like faceting or position adjustments, but
          grammar usage is appropriate for this plot type.'
  verdict: APPROVED
