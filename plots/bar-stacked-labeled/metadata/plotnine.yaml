library: plotnine
specification_id: bar-stacked-labeled
created: '2026-01-09T15:31:24Z'
updated: '2026-01-09T15:34:04Z'
generated_by: claude-opus-4-5-20251101
workflow_run: 20856772243
issue: 3504
python_version: 3.13.11
library_version: 0.15.2
preview_url: https://storage.googleapis.com/pyplots-images/plots/bar-stacked-labeled/plotnine/plot.png
preview_thumb: https://storage.googleapis.com/pyplots-images/plots/bar-stacked-labeled/plotnine/plot_thumb.png
preview_html: null
quality_score: 92
review:
  strengths:
  - Excellent implementation of ggplot2 grammar of graphics with plotnine
  - Clear segment labels within bars with good contrast (white bold text)
  - Total labels prominently displayed above each bar stack
  - Clean, professional appearance with minimal theme
  - Good use of position_stack for both bars and text labels
  - Proper categorical ordering ensures consistent stacking
  weaknesses:
  - The legend shows Services as dark blue but in the actual stacked bars, Services
    appears at the top in light blue - this is a visual consistency issue with the
    category ordering vs fill color assignment
  image_description: The plot displays a stacked bar chart showing quarterly revenue
    by product category (Software, Hardware, Services) across Q1-Q4. The bars are
    stacked with Software (dark blue) at the bottom, Hardware (yellow) in the middle,
    and Services (light blue) at the top. Each segment displays its individual value
    in white bold text centered within the segment. Total values (250, 295, 318, 388)
    are displayed in bold black text above each bar stack. The title follows the correct
    format with spec-id, library, and pyplots.ai. Axes are clearly labeled with "Quarter"
    on x-axis and "Revenue ($ thousands)" on y-axis. A legend on the right identifies
    the three product categories. The color palette uses Python-inspired colors (blue
    tones and yellow). The layout is clean with minimal theme styling and no distracting
    grid lines on the x-axis.
  criteria_checklist:
    visual_quality:
      score: 36
      max: 40
      items:
      - id: VQ-01
        name: Text Legibility
        score: 10
        max: 10
        passed: true
        comment: 'All text clearly readable: title is bold 24pt, axis labels 20pt,
          tick labels 16-18pt, segment labels and totals are bold and visible'
      - id: VQ-02
        name: No Overlap
        score: 8
        max: 8
        passed: true
        comment: No overlapping text elements; segment labels fit well within bars
      - id: VQ-03
        name: Element Visibility
        score: 8
        max: 8
        passed: true
        comment: Bar segments are well-sized and clearly distinguishable
      - id: VQ-04
        name: Color Accessibility
        score: 3
        max: 5
        passed: true
        comment: Blue/yellow palette is generally accessible but could be improved
          with more distinct colors for all three categories
      - id: VQ-05
        name: Layout Balance
        score: 5
        max: 5
        passed: true
        comment: Good canvas utilization, balanced margins, legend positioned well
      - id: VQ-06
        name: Axis Labels
        score: 2
        max: 2
        passed: true
        comment: Y-axis has units Revenue ($ thousands), X-axis is descriptive Quarter
      - id: VQ-07
        name: Grid & Legend
        score: 0
        max: 2
        passed: false
        comment: Legend colors show Services as dark blue when it appears light blue
          in the chart - color mapping discrepancy
    spec_compliance:
      score: 25
      max: 25
      items:
      - id: SC-01
        name: Plot Type
        score: 8
        max: 8
        passed: true
        comment: Correct stacked bar chart
      - id: SC-02
        name: Data Mapping
        score: 5
        max: 5
        passed: true
        comment: Quarters on X, Revenue on Y, Products as stacked components
      - id: SC-03
        name: Required Features
        score: 5
        max: 5
        passed: true
        comment: Has total labels above bars and segment labels within bars
      - id: SC-04
        name: Data Range
        score: 3
        max: 3
        passed: true
        comment: All data visible, adequate vertical space for labels
      - id: SC-05
        name: Legend Accuracy
        score: 2
        max: 2
        passed: true
        comment: Legend correctly identifies the three product categories
      - id: SC-06
        name: Title Format
        score: 2
        max: 2
        passed: true
        comment: Title follows correct format with spec-id, library, and pyplots.ai
    data_quality:
      score: 18
      max: 20
      items:
      - id: DQ-01
        name: Feature Coverage
        score: 7
        max: 8
        passed: true
        comment: Shows stacking, totals, and segment labels well; shows growth trend
          across quarters
      - id: DQ-02
        name: Realistic Context
        score: 7
        max: 7
        passed: true
        comment: Quarterly revenue by product is a realistic business scenario
      - id: DQ-03
        name: Appropriate Scale
        score: 4
        max: 5
        passed: true
        comment: Values are reasonable for revenue in thousands
    code_quality:
      score: 8
      max: 10
      items:
      - id: CQ-01
        name: KISS Structure
        score: 3
        max: 3
        passed: true
        comment: Clean imports, data, plot, save structure
      - id: CQ-02
        name: Reproducibility
        score: 2
        max: 3
        passed: true
        comment: Data is deterministic (hardcoded), no random generation used
      - id: CQ-03
        name: Clean Imports
        score: 2
        max: 2
        passed: true
        comment: All imports are used
      - id: CQ-04
        name: No Deprecated API
        score: 1
        max: 1
        passed: true
        comment: Uses current plotnine API
      - id: CQ-05
        name: Output Correct
        score: 0
        max: 1
        passed: true
        comment: Saves as plot.png
    library_features:
      score: 5
      max: 5
      items:
      - id: LF-01
        name: Distinctive Features
        score: 5
        max: 5
        passed: true
        comment: 'Excellent use of ggplot grammar: aes mapping, geom_bar with position_stack,
          geom_text with position_stack, scale_fill_manual, theme_minimal with extensive
          customization'
  verdict: APPROVED
impl_tags:
  dependencies: []
  techniques:
  - annotations
  - layer-composition
  patterns:
  - groupby-aggregation
  dataprep: []
  styling:
  - grid-styling
