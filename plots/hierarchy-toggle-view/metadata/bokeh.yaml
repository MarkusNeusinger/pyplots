library: bokeh
specification_id: hierarchy-toggle-view
created: '2026-01-11T09:31:55Z'
updated: '2026-01-11T10:00:04Z'
generated_by: claude-opus-4-5-20251101
workflow_run: 20892893155
issue: 3697
python_version: 3.13.11
library_version: 3.8.2
preview_url: https://storage.googleapis.com/pyplots-images/plots/hierarchy-toggle-view/bokeh/plot.png
preview_thumb: https://storage.googleapis.com/pyplots-images/plots/hierarchy-toggle-view/bokeh/plot_thumb.png
preview_html: https://storage.googleapis.com/pyplots-images/plots/hierarchy-toggle-view/bokeh/plot.html
quality_score: 72
review:
  strengths:
  - Realistic company budget hierarchy data with clear department structure
  - Good treemap layout algorithm implementation
  - Colors are generally distinguishable
  - Interactive HTML version includes proper toggle functionality with CustomJS
  - Clean code organization with separate PNG and HTML generation
  weaknesses:
  - PNG output only shows treemap view - sunburst is not visible (spec requires toggle
    between both views)
  - Legend only shows 4 parent departments, not matching the 13+ colors visible in
    treemap
  - Code is overly complex with inline squarify algorithm
  - Panel labels and toggle arrow from code are not visible in output
  image_description: 'The plot shows only a treemap view of a company budget hierarchy.
    The treemap displays 13 colored rectangles representing sub-departments (Backend,
    Frontend, Digital, QA, DevOps, Facilities, Logistics, Content, Analytics, Recruiting,
    Training, Benefits, Procurement). Each rectangle is sized proportionally to its
    budget value and labeled with the department name and budget (e.g., "Backend $1500K").
    Colors include red (Frontend), blue (Backend), yellow (Digital), green (DevOps,
    Content), orange (Logistics, Facilities, Procurement), purple/cyan (Recruiting,
    Training, Benefits), and others. A small "Departments" legend appears in the top-right
    corner showing only the 4 parent categories: Engineering, Marketing, Operations,
    and HR. The title "hierarchy-toggle-view · bokeh · pyplots.ai" is displayed at
    the top left in blue text. Critically, the sunburst view that should be shown
    alongside the treemap is NOT visible in the PNG output - only the treemap is rendered.
    The code intended to show both views side-by-side with panel labels and a toggle
    arrow, but these elements are also not visible in the final output.'
  criteria_checklist:
    visual_quality:
      score: 32
      max: 40
      items:
      - id: VQ-01
        name: Text Legibility
        score: 8
        max: 10
        passed: true
        comment: Labels readable but value text is somewhat small
      - id: VQ-02
        name: No Overlap
        score: 8
        max: 8
        passed: true
        comment: No overlapping text elements
      - id: VQ-03
        name: Element Visibility
        score: 6
        max: 8
        passed: true
        comment: Rectangles visible but some are quite small
      - id: VQ-04
        name: Color Accessibility
        score: 4
        max: 5
        passed: true
        comment: Generally colorblind-safe but some similar hues
      - id: VQ-05
        name: Layout Balance
        score: 3
        max: 5
        passed: true
        comment: Treemap fills canvas well but legend is minimal
      - id: VQ-06
        name: Axis Labels
        score: 2
        max: 2
        passed: true
        comment: N/A for treemap, labels present on rectangles
      - id: VQ-07
        name: Grid & Legend
        score: 1
        max: 2
        passed: false
        comment: Legend shows only 4 parent departments, not all colors
    spec_compliance:
      score: 15
      max: 25
      items:
      - id: SC-01
        name: Plot Type
        score: 4
        max: 8
        passed: false
        comment: Only treemap visible, sunburst NOT shown in PNG
      - id: SC-02
        name: Data Mapping
        score: 5
        max: 5
        passed: true
        comment: Data correctly mapped to rectangle sizes
      - id: SC-03
        name: Required Features
        score: 2
        max: 5
        passed: false
        comment: Toggle button missing from PNG, no sunburst visible
      - id: SC-04
        name: Data Range
        score: 3
        max: 3
        passed: true
        comment: All data visible
      - id: SC-05
        name: Legend Accuracy
        score: 0
        max: 2
        passed: false
        comment: Legend shows only 4 parent departments, not matching all rectangle
          colors
      - id: SC-06
        name: Title Format
        score: 1
        max: 2
        passed: false
        comment: Correct format but missing panel labels
    data_quality:
      score: 18
      max: 20
      items:
      - id: DQ-01
        name: Feature Coverage
        score: 7
        max: 8
        passed: true
        comment: Good hierarchy with 3 levels, 18 nodes
      - id: DQ-02
        name: Realistic Context
        score: 7
        max: 7
        passed: true
        comment: Company budget allocation is realistic and neutral
      - id: DQ-03
        name: Appropriate Scale
        score: 4
        max: 5
        passed: true
        comment: Budget values are realistic
    code_quality:
      score: 7
      max: 10
      items:
      - id: CQ-01
        name: KISS Structure
        score: 1
        max: 3
        passed: false
        comment: Code is quite long with inline squarify algorithm
      - id: CQ-02
        name: Reproducibility
        score: 3
        max: 3
        passed: true
        comment: np.random.seed(42) present
      - id: CQ-03
        name: Clean Imports
        score: 1
        max: 2
        passed: false
        comment: Div import used only in HTML version
      - id: CQ-04
        name: No Deprecated API
        score: 1
        max: 1
        passed: true
        comment: Current API usage
      - id: CQ-05
        name: Output Correct
        score: 1
        max: 1
        passed: true
        comment: Saves as plot.png
    library_features:
      score: 0
      max: 5
      items:
      - id: LF-01
        name: Distinctive Features
        score: 0
        max: 5
        passed: false
        comment: HTML version has CustomJS callbacks but PNG fails to show both views
  verdict: APPROVED
impl_tags:
  dependencies: []
  techniques:
  - patches
  - annotations
  - hover-tooltips
  - custom-legend
  - html-export
  patterns:
  - data-generation
  - columndatasource
  - iteration-over-groups
  dataprep: []
  styling:
  - alpha-blending
  - edge-highlighting
