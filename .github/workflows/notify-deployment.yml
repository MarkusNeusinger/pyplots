name: Notify Deployment

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - 'app/**'
      - 'api/**'
      - 'core/**'
      - 'pyproject.toml'

jobs:
  changes:
    runs-on: ubuntu-latest
    outputs:
      app: ${{ steps.filter.outputs.app }}
      api: ${{ steps.filter.outputs.api }}
    steps:
      - uses: actions/checkout@v4
      - uses: dorny/paths-filter@v3
        id: filter
        with:
          filters: |
            app:
              - 'app/**'
            api:
              - 'api/**'
              - 'core/**'
              - 'pyproject.toml'

  app:
    needs: changes
    if: needs.changes.outputs.app == 'true'
    runs-on: ubuntu-latest
    environment:
      name: app
      url: https://pyplots.ai
    steps:
      - run: echo "Frontend deployed via Cloud Build"

  api:
    needs: changes
    if: needs.changes.outputs.api == 'true'
    runs-on: ubuntu-latest
    environment:
      name: api
      url: https://api.pyplots.ai/docs
    steps:
      - run: echo "API deployed via Cloud Build"
