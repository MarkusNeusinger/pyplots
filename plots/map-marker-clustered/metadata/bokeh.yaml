library: bokeh
specification_id: map-marker-clustered
created: '2026-01-20T18:50:28Z'
updated: '2026-01-20T19:04:32Z'
generated_by: claude-opus-4-5-20251101
workflow_run: 21183368742
issue: 3766
python_version: 3.13.11
library_version: 3.8.2
preview_url: https://storage.googleapis.com/pyplots-images/plots/map-marker-clustered/bokeh/plot.png
preview_thumb: https://storage.googleapis.com/pyplots-images/plots/map-marker-clustered/bokeh/plot_thumb.png
preview_html: https://storage.googleapis.com/pyplots-images/plots/map-marker-clustered/bokeh/plot.html
quality_score: 91
review:
  strengths:
  - Excellent implementation of grid-based clustering algorithm with proper Web Mercator
    projection
  - Clear visualization with well-sized cluster markers and legible count labels
  - 'Good use of Bokeh features: tile basemap, ColumnDataSource, LabelSet, custom
    Legend'
  - Realistic coffee shop scenario with 10 NYC neighborhoods
  - Both PNG and HTML outputs generated for static and interactive viewing
  weaknesses:
  - Title includes extra Store Locations prefix instead of pure spec-id format
  - Legend only shows categories that appear as dominant in clusters, may not show
    all 4 store types
  - Static clustering cannot demonstrate zoom-based expansion (spec mentions smooth
    zoom transitions)
  image_description: 'The plot displays a clustered marker map of coffee shop store
    locations across the New York City metropolitan area. The background is a CartoDB
    Positron basemap showing street-level detail including neighborhoods like Downtown,
    Midtown, Brooklyn Heights, and Williamsburg. Cluster markers are rendered as circles
    with white count labels indicating the number of stores in each cluster (ranging
    from 4 to 45). Markers are color-coded by dominant store type: blue (#306998)
    for Coffee-dominant clusters and yellow (#FFD43B) for Express-dominant clusters.
    A legend on the right side shows "Store Type" with three categories visible. Faint
    individual store markers (small blue dots with low opacity) are visible underneath
    the cluster markers. An italicized annotation at the bottom reads "Clustered markers
    show aggregated store counts." The title "Store Locations · map-marker-clustered
    · bokeh · pyplots.ai" appears at the top left. Axis labels show "Easting (m)"
    and "Northing (m)" for the Web Mercator projection.'
  criteria_checklist:
    visual_quality:
      score: 36
      max: 40
      items:
      - id: VQ-01
        name: Text Legibility
        score: 9
        max: 10
        passed: true
        comment: Title and legend text are readable; count labels on clusters are
          clear with bold white text; axis labels appropriately sized at 24pt
      - id: VQ-02
        name: No Overlap
        score: 8
        max: 8
        passed: true
        comment: Cluster markers are well-separated with no overlapping text or elements
      - id: VQ-03
        name: Element Visibility
        score: 8
        max: 8
        passed: true
        comment: Cluster markers are well-sized (45-110px based on count), clearly
          visible against the basemap with good contrast
      - id: VQ-04
        name: Color Accessibility
        score: 4
        max: 5
        passed: true
        comment: Blue/yellow palette is colorblind-safe; good contrast between marker
          colors and basemap
      - id: VQ-05
        name: Layout Balance
        score: 5
        max: 5
        passed: true
        comment: Map fills canvas appropriately; legend positioned on right side without
          obscuring data; good use of space
      - id: VQ-06
        name: Axis Labels
        score: 2
        max: 2
        passed: true
        comment: 'Descriptive labels with units: Easting (m) and Northing (m)'
      - id: VQ-07
        name: Grid & Legend
        score: 0
        max: 2
        passed: false
        comment: Legend shows only 3 categories but code defines 4; not all categories
          represented in legend
    spec_compliance:
      score: 23
      max: 25
      items:
      - id: SC-01
        name: Plot Type
        score: 8
        max: 8
        passed: true
        comment: Correct clustered marker map implementation with geographic basemap
      - id: SC-02
        name: Data Mapping
        score: 5
        max: 5
        passed: true
        comment: Lat/lon correctly converted to Web Mercator; cluster positions accurately
          calculated
      - id: SC-03
        name: Required Features
        score: 4
        max: 5
        passed: true
        comment: Has clustering, count display, color-coding by category, basemap;
          missing interactive zoom behavior
      - id: SC-04
        name: Data Range
        score: 3
        max: 3
        passed: true
        comment: All NYC area data visible within the defined view range
      - id: SC-05
        name: Legend Accuracy
        score: 2
        max: 2
        passed: true
        comment: Legend correctly shows store types with dominant clarification
      - id: SC-06
        name: Title Format
        score: 1
        max: 2
        passed: false
        comment: Title has extra Store Locations prefix instead of pure spec-id format
    data_quality:
      score: 19
      max: 20
      items:
      - id: DQ-01
        name: Feature Coverage
        score: 7
        max: 8
        passed: true
        comment: Shows clustering with varying counts, multiple categories, geographic
          distribution across neighborhoods
      - id: DQ-02
        name: Realistic Context
        score: 7
        max: 7
        passed: true
        comment: Coffee shop chain in NYC is a realistic, neutral scenario with plausible
          neighborhood distribution
      - id: DQ-03
        name: Appropriate Scale
        score: 5
        max: 5
        passed: true
        comment: 270 total stores across 10 neighborhoods with realistic lat/lon coordinates
          for NYC
    code_quality:
      score: 10
      max: 10
      items:
      - id: CQ-01
        name: KISS Structure
        score: 3
        max: 3
        passed: true
        comment: 'Linear script: imports, data generation, clustering, plotting, save'
      - id: CQ-02
        name: Reproducibility
        score: 3
        max: 3
        passed: true
        comment: Uses np.random.seed(42)
      - id: CQ-03
        name: Clean Imports
        score: 2
        max: 2
        passed: true
        comment: All imports are used (numpy, bokeh components)
      - id: CQ-04
        name: No Deprecated API
        score: 1
        max: 1
        passed: true
        comment: Uses current Bokeh 3.x API
      - id: CQ-05
        name: Output Correct
        score: 1
        max: 1
        passed: true
        comment: Saves as plot.png and plot.html
    library_features:
      score: 3
      max: 5
      items:
      - id: LF-01
        name: Distinctive Features
        score: 3
        max: 5
        passed: true
        comment: Uses tile providers, ColumnDataSource, LabelSet, Legend customization,
          hover tooltips, HTML export; could better leverage Bokeh callbacks
  verdict: APPROVED
impl_tags:
  dependencies: []
  techniques:
  - annotations
  - hover-tooltips
  - custom-legend
  - html-export
  patterns:
  - data-generation
  - iteration-over-groups
  - columndatasource
  dataprep: []
  styling:
  - alpha-blending
  - edge-highlighting
