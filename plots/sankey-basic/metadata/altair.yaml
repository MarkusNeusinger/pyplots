library: altair
specification_id: sankey-basic
created: '2025-12-23T19:50:52Z'
updated: '2025-12-23T19:57:56Z'
generated_by: claude-opus-4-5-20251101
workflow_run: 20470109773
issue: 0
python_version: 3.13.11
library_version: 6.0.0
preview_url: https://storage.googleapis.com/pyplots-images/plots/sankey-basic/altair/plot.png
preview_thumb: https://storage.googleapis.com/pyplots-images/plots/sankey-basic/altair/plot_thumb.png
preview_html: https://storage.googleapis.com/pyplots-images/plots/sankey-basic/altair/plot.html
quality_score: 91
review:
  strengths:
  - Excellent manual implementation of Sankey diagram using Altair primitive marks
    (rectangles + filled polygons)
  - Smooth S-curve interpolation for flow bands using smoothstep function creates
    natural-looking flows
  - Well-organized color scheme with Python Blue (#306998) as primary source color
  - Clean layer composition (links → nodes → source labels → target labels)
  - Good use of tooltips for interactivity on node hover
  - Proper title format with informative subtitle
  weaknesses:
  - The three blue shades for Coal, Gas, and Nuclear sources are visually similar;
    wider color variation would improve distinguishability
  - Code complexity is high due to manual polygon generation; this is necessary since
    Altair lacks native Sankey support, but adds maintenance burden
  image_description: 'The plot displays a Sankey diagram showing energy flow from
    four source nodes (Renewable, Nuclear, Gas, Coal) positioned on the left side
    to four target sector nodes (Transport, Industrial, Commercial, Residential) on
    the right. The flows are rendered as smooth S-curved bands with semi-transparent
    fill (opacity ~0.55), colored by source category. Source nodes use a blue palette
    (Coal: #306998, Gas: #4A8BC6, Nuclear: #2D5986) with Renewable in yellow (#FFD43B).
    Target nodes are colored distinctly (teal shades for Residential/Commercial, coral/red
    for Industrial/Transport). Node labels are positioned adjacent to their respective
    rectangles in bold black text. The title "sankey-basic · altair · pyplots.ai"
    appears centered at top with subtitle "Energy Flow from Sources to Sectors". A
    legend in the bottom-right corner shows the "Energy Source" color mapping.'
  criteria_checklist:
    visual_quality:
      score: 36
      max: 40
      items:
      - id: VQ-01
        name: Text Legibility
        score: 10
        max: 10
        passed: true
        comment: Title at 28pt, labels at 20pt bold, all clearly readable
      - id: VQ-02
        name: No Overlap
        score: 8
        max: 8
        passed: true
        comment: No overlapping text, all labels positioned outside nodes
      - id: VQ-03
        name: Element Visibility
        score: 7
        max: 8
        passed: true
        comment: Flow bands well-sized, nodes visible with stroke, slight deduction
          as some crossing flows can be hard to trace
      - id: VQ-04
        name: Color Accessibility
        score: 4
        max: 5
        passed: true
        comment: Good color distinction overall, though blue shades for Coal/Gas/Nuclear
          are somewhat similar
      - id: VQ-05
        name: Layout Balance
        score: 5
        max: 5
        passed: true
        comment: Excellent use of canvas, nodes well-spaced, balanced margins
      - id: VQ-07
        name: Grid & Legend
        score: 2
        max: 2
        passed: true
        comment: Legend well-placed in bottom-right, no grid needed for Sankey
    spec_compliance:
      score: 25
      max: 25
      items:
      - id: SC-01
        name: Plot Type
        score: 8
        max: 8
        passed: true
        comment: Correct Sankey diagram with nodes and flow links
      - id: SC-02
        name: Data Mapping
        score: 5
        max: 5
        passed: true
        comment: Source→Target flows with proportional widths correctly implemented
      - id: SC-03
        name: Required Features
        score: 5
        max: 5
        passed: true
        comment: 'All spec features present: categorical nodes, flow values, distinct
          colors'
      - id: SC-04
        name: Data Range
        score: 3
        max: 3
        passed: true
        comment: All flows visible, node heights proportional to totals
      - id: SC-05
        name: Legend Accuracy
        score: 2
        max: 2
        passed: true
        comment: Legend correctly shows energy source colors
      - id: SC-06
        name: Title Format
        score: 2
        max: 2
        passed: true
        comment: Exact format "sankey-basic · altair · pyplots.ai" used
    data_quality:
      score: 18
      max: 20
      items:
      - id: DQ-01
        name: Feature Coverage
        score: 7
        max: 8
        passed: true
        comment: Shows multiple sources flowing to multiple targets with varying magnitudes;
          slight deduction as no extremely dominant or extremely minor flows shown
      - id: DQ-02
        name: Realistic Context
        score: 7
        max: 7
        passed: true
        comment: Energy flow from sources to sectors is a classic, realistic Sankey
          use case
      - id: DQ-03
        name: Appropriate Scale
        score: 4
        max: 5
        passed: true
        comment: Values (10-45 units) are plausible; could benefit from showing more
          extreme differences
    code_quality:
      score: 8
      max: 10
      items:
      - id: CQ-01
        name: KISS Structure
        score: 2
        max: 3
        passed: true
        comment: Linear flow structure, but complex manual polygon calculation; no
          functions/classes used though
      - id: CQ-02
        name: Reproducibility
        score: 3
        max: 3
        passed: true
        comment: Deterministic data (hardcoded flows), no random elements
      - id: CQ-03
        name: Clean Imports
        score: 2
        max: 2
        passed: true
        comment: Only altair and pandas imported, both used
      - id: CQ-04
        name: No Deprecated API
        score: 1
        max: 1
        passed: true
        comment: Uses current Altair API
      - id: CQ-05
        name: Output Correct
        score: 0
        max: 1
        passed: true
        comment: Saves as "plot.png" but also saves "plot.html" which is fine
    library_features:
      score: 4
      max: 5
      items:
      - id: LF-01
        name: Uses distinctive library features
        score: 4
        max: 5
        passed: true
        comment: Excellent use of Altair's declarative layering, mark_line with filled
          polygons, detailed encoding with tooltips, and legend configuration
  verdict: APPROVED
