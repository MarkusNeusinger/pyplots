library: bokeh
specification_id: bubble-map-geographic
created: '2026-01-10T06:09:10Z'
updated: '2026-01-10T06:11:44Z'
generated_by: claude-opus-4-5-20251101
workflow_run: 20873957946
issue: 3625
python_version: 3.13.11
library_version: 3.8.2
preview_url: https://storage.googleapis.com/pyplots-images/plots/bubble-map-geographic/bokeh/plot.png
preview_thumb: https://storage.googleapis.com/pyplots-images/plots/bubble-map-geographic/bokeh/plot_thumb.png
preview_html: https://storage.googleapis.com/pyplots-images/plots/bubble-map-geographic/bokeh/plot.html
quality_score: 91
review:
  strengths:
  - Excellent use of Bokeh tile mapping capabilities with CartoDB Positron basemap
  - Well-implemented Web Mercator coordinate transformation for accurate geographic
    positioning
  - Interactive tooltips showing city name, population, region, and coordinates
  - 'Dual legend system: region colors + size reference bubbles'
  - Good color palette that distinguishes 5 regions while remaining colorblind-safe
  - Area-proportional sizing (using sqrt) for accurate visual perception of population
    differences
  weaknesses:
  - Helper function lat_lon_to_mercator adds complexity (though arguably necessary
    for coordinate conversion)
  - Axis labels lack explicit units (could be Longitude and Latitude with degree symbols)
  image_description: 'The plot displays a geographic bubble map showing world cities
    by population. It uses a CartoDB Positron tile basemap showing country boundaries
    and coastlines in light gray tones. Bubbles are placed at city locations with
    sizes proportional to population (using square root scaling for area-proportional
    encoding). The color scheme distinguishes regions: blue (#306998) for Asia, yellow
    (#FFD43B) for Americas, light blue (#4B8BBE) for Europe, purple (#9B59B6) for
    Africa, and green (#27AE60) for Oceania. Tokyo appears as the largest bubble in
    Asia. The map shows the world from approximately -15000km to 22000km in x-coordinates
    (Web Mercator). A region legend is positioned on the right side, and a size legend
    showing reference bubbles for 5M, 15M, 25M, and 35M populations is also visible
    on the right. The title "World Cities by Population · bubble-map-geographic ·
    bokeh · pyplots.ai" appears at the top left in blue. Axis labels show "Longitude"
    and "Latitude".'
  criteria_checklist:
    visual_quality:
      score: 36
      max: 40
      items:
      - id: VQ-01
        name: Text Legibility
        score: 9
        max: 10
        passed: true
        comment: Title at 32pt, axis labels at 24pt, tick labels at 18pt are well-sized
          but legend text could be slightly larger for the image size
      - id: VQ-02
        name: No Overlap
        score: 8
        max: 8
        passed: true
        comment: No overlapping text elements, bubbles have appropriate spacing for
          most cities
      - id: VQ-03
        name: Element Visibility
        score: 7
        max: 8
        passed: true
        comment: Bubbles are well-sized with alpha=0.6, but some smaller cities have
          relatively small markers
      - id: VQ-04
        name: Color Accessibility
        score: 5
        max: 5
        passed: true
        comment: Good colorblind-safe palette using blue, yellow, purple, green
      - id: VQ-05
        name: Layout Balance
        score: 5
        max: 5
        passed: true
        comment: Map fills canvas well, legends are positioned on the right with good
          spacing
      - id: VQ-06
        name: Axis Labels
        score: 1
        max: 2
        passed: true
        comment: Labels say Longitude and Latitude but no units
      - id: VQ-07
        name: Grid & Legend
        score: 1
        max: 2
        passed: true
        comment: Region legend is clear, size legend is useful but positioned slightly
          far from map
    spec_compliance:
      score: 24
      max: 25
      items:
      - id: SC-01
        name: Plot Type
        score: 8
        max: 8
        passed: true
        comment: Correct bubble map with geographic tile basemap
      - id: SC-02
        name: Data Mapping
        score: 5
        max: 5
        passed: true
        comment: Latitude/longitude correctly mapped to Web Mercator, size correctly
          maps population
      - id: SC-03
        name: Required Features
        score: 4
        max: 5
        passed: true
        comment: Has size legend, region color grouping, tooltips, transparency -
          missing explicit city name labels on map
      - id: SC-04
        name: Data Range
        score: 3
        max: 3
        passed: true
        comment: View range shows all 25 cities properly
      - id: SC-05
        name: Legend Accuracy
        score: 2
        max: 2
        passed: true
        comment: Both region and size legends accurately reflect the data
      - id: SC-06
        name: Title Format
        score: 2
        max: 2
        passed: true
        comment: Correctly formatted as spec-id · library · pyplots.ai
    data_quality:
      score: 18
      max: 20
      items:
      - id: DQ-01
        name: Feature Coverage
        score: 7
        max: 8
        passed: true
        comment: Shows varied populations from 3.6M to 37.4M, good geographic spread,
          multiple regions
      - id: DQ-02
        name: Realistic Context
        score: 7
        max: 7
        passed: true
        comment: Real world cities with accurate 2024 population estimates
      - id: DQ-03
        name: Appropriate Scale
        score: 4
        max: 5
        passed: true
        comment: Population values are realistic with minor variations
    code_quality:
      score: 8
      max: 10
      items:
      - id: CQ-01
        name: KISS Structure
        score: 2
        max: 3
        passed: true
        comment: Code has a helper function lat_lon_to_mercator which adds slight
          complexity
      - id: CQ-02
        name: Reproducibility
        score: 3
        max: 3
        passed: true
        comment: Uses np.random.seed(42)
      - id: CQ-03
        name: Clean Imports
        score: 2
        max: 2
        passed: true
        comment: All imports are used appropriately
      - id: CQ-04
        name: No Deprecated API
        score: 1
        max: 1
        passed: true
        comment: Uses current Bokeh API
      - id: CQ-05
        name: Output Correct
        score: 0
        max: 1
        passed: false
        comment: Saves as plot.png but also saves plot.html
    library_features:
      score: 5
      max: 5
      items:
      - id: LF-01
        name: Distinctive Features
        score: 5
        max: 5
        passed: true
        comment: Excellent use of Bokeh WMTSTileSource, ColumnDataSource, HoverTool
          with custom tooltips, interactive tools, HTML export with CDN
  verdict: APPROVED
impl_tags:
  dependencies: []
  techniques:
  - hover-tooltips
  - custom-legend
  - annotations
  - html-export
  patterns:
  - data-generation
  - columndatasource
  - iteration-over-groups
  dataprep:
  - normalization
  styling:
  - alpha-blending
  - edge-highlighting
